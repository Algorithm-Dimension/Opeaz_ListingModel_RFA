<form method="post">
    {% csrf_token %}
    {{ condition_number_form.as_p }}

    <input type="submit" value="Calculer">
</form>
<form method="post">
{% if forms %}
    {% for form in forms %}
        <h3>Condition {{ forloop.counter }} </h3>
            {% csrf_token %}

    <table>
      <label for="what_{{ forloop.counter }}">Quoi :</label>
  <select id="what_{{ forloop.counter }}" name="what_{{ forloop.counter }}">
    <option value="CA">Chiffre d'affaires</option>
    <option value="Benefice">Benefice</option>
    <option value="gondole">Tete de gondole</option>
  </select>
&nbsp
      <label for="who_{{ forloop.counter }}">Qui :</label>
  <select id="who_{{ forloop.counter }}" name="who_{{ forloop.counter }}">
    <option value="produit">Produit</option>
    <option value="gamme">Gamme</option>
    <option value="total">Total</option>
  </select> &nbsp
      <label for="operator_{{ forloop.counter }}">Opérateur :</label>
  <select id="operator_{{ forloop.counter }}" name="operator_{{ forloop.counter }}">
    <option value="lt"><</option>
    <option value="gt">></option>
    <option value="eq">=</option>
  </select> &nbsp
   {{ form.quantity.label_tag }} {{ form.quantity }} &nbsp
      <label for="unit_{{ forloop.counter }}">Unité :</label>
        <select id="unit_{{ forloop.counter }}" name="unité_{{ forloop.counter }}">
    <option value="percentile">%</option>
    <option value="currency">€</option>
    <option value="quantity">quantité</option>
  </select> &nbsp
         {{ form.quantity.start_date }} {{ form.start_date }} &nbsp
         {{ form.quantity.end_date }} {{ form.end_date }}

&nbsp
    </table>
    {% endfor %}

    {% csrf_token %}
    {{ entire_form.as_p }}

    <input type="submit" value="Calculer">
</form>
{% endif %}

<script>
  const what = document.getElementById('what_1');
  const unit = document.getElementById('unit_1');

  // Disable specific options in field2 based on the selected value of field1
  function updateField2Options() {
    const selectedValue = what.value;

    // Enable all options in field2
    for (let i = 0; i < unit.options.length; i++) {
      unit.options[i].disabled = false;
    }

    // Disable specific options based on selectedValue
    if (selectedValue === 'gondole') {
      unit.options[0].disabled = true;
      unit.options[1].disabled = true;
      unit.options[2].selected = true;
    }
  }

  what.addEventListener('change', function() {
    updateField2Options();
  });

  // Initial update of field2 options
  updateField2Options();
</script>
<script>
  // Disable specific options in unit based on the selected value of what
  function updateField2Options(whatId, unitId) {
    const what = document.getElementById(whatId);
    const unit = document.getElementById(unitId);
    const selectedValue = what.value;

    // Enable all options in unit
    for (let i = 0; i < unit.options.length; i++) {
      unit.options[i].disabled = false;
    }

    // Disable specific options based on selectedValue
    if (selectedValue === 'gondole') {
      unit.options[0].disabled = true;
      unit.options[1].disabled = true;
      unit.options[2].selected = true;
    }
  }

  // Initial update of field2 options for each what element
  for (let i = 0; i < {{ n }}; i++) {
    const whatId = `what_${i + 1}`;
    const unitId = `unit_${i + 1}`;
    const whatElement = document.getElementById(whatId);

    // Add event listener to each what element
    whatElement.addEventListener('change', function() {
      updateField2Options(whatId, unitId);
    });

    // Initial update of field2 options
    updateField2Options(whatId, unitId);
  }
</script>

